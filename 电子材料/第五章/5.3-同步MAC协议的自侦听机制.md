# 自适应侦听机制
当流量负载较轻时，周期性侦听和休眠的方案能够显着减少空闲侦听所花费的时间。然而，当每个节点严格遵循其睡眠时间表时，每一跳都有一个潜在的延迟，其平均值与帧的长度成比例。如图5-14所示，在一个三跳的网络中，A的下一跳是B，B的下一跳是C。当B接收完A发送的数据后，试图将数据转发给C。但由于C在睡眠中，B只能等候下一个侦听周期开始，再向C发送数据。

<div align=center>
<img src=".\pics\fig5-周期性睡眠造成的时延问题.png" width="80%">

图5-14周期性睡眠造成的时延问题
</div>

因此，S-MAC引入了自适应侦听机制，在这种情况下将节点从低占空比模式切换到更活跃的模式，以改善多跳网络中每个节点的周期性休眠所引起的延迟。基本思想是让那些无意中偷听到其邻居节点传输的节点（在理想情况下偷听到的只有RTS或CTS），根据偷听到的RTS或CTS信息，在邻居节点的传输结束时唤醒一小段时间。这样，如果自己是邻居的下一跳节点，则其邻居能够立即将数据传递给自己，而不必等到预定的下一次监听周期开始。

如果下一跳节点是发送方的邻居，则它会偷听到RTS。如果它只是接收节点的邻居，则会偷听到CTS。因此，不管是发送方还是接收方的邻居，都能通过RTS或CTS了解传输的持续时间。当传输结束时，它们能够自适应地唤醒。如图5-15所示，节点C是B的邻居，偷听到B发出的CTS后，C节点将在传输结束时醒来，B能够直接与C进行通信，避免了睡眠造成的时延。

<div align=center>
<img src=".\pics\fig5-自适应侦听机制.png" width="80%">

图5-15自适应侦听机制
</div>

如果节点在自适应侦听期间没有收到任何内容，它将返回休眠状态直到其下一个预定的监听时间醒来。

应当注意，并非所有的下一跳节点都可以从先前的传输中偷听到RTS或CTS，尤其是当先前的传输是在自适应侦听期间发生时，即，不是在预定时间表的监听时间发生。因此，如果发送方在自适应侦听期间通过发送RTS数据包来启动传输，也可能无法获得CTS回复。在这种情况下，它会重新进入睡眠状态，并会在下一个预定时间表上的监听时间再次尝试。
